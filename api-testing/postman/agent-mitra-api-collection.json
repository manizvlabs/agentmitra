{
  "info": {
    "name": "Agent Mitra API Collection",
    "description": "Comprehensive API collection for Agent Mitra backend with feature flags",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "agent-mitra"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8015",
      "type": "string"
    },
    {
      "key": "super_admin_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "provider_admin_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "super_admin_user_id",
      "value": "550e8400-e29b-41d4-a716-446655440000",
      "type": "string"
    },
    {
      "key": "provider_admin_user_id",
      "value": "660e8400-e29b-41d4-a716-446655440000",
      "type": "string"
    },
    {
      "key": "test_flag_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "test_user_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "test_user_id",
      "value": "650742fb-5fa7-4913-8e4f-cdad3ccbe476",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "\ud83d\udcdc Core System",
      "item": [
        {
          "name": "\ud83d\udd10 Authentication & Authorization",
          "item": [
            {
              "name": "Super Admin Login",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\"phone_number\": \"+919876543200\", \"password\": \"testpassword\"}"
                },
                "url": {
                  "raw": "{{base_url}}/auth/login",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "auth",
                    "login"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has access token\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('access_token');",
                      "    pm.environment.set('super_admin_token', jsonData.access_token);",
                      "});",
                      "",
                      "pm.test(\"User is super admin\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.user.role).to.eql('super_admin');",
                      "});",
                      "",
                      "pm.test(\"Has system.admin permission\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.permissions).to.include('system.admin');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Provider Admin Login",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\"phone_number\": \"+919876543201\", \"password\": \"testpassword\"}"
                },
                "url": {
                  "raw": "{{base_url}}/auth/login",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "auth",
                    "login"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has access token\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.environment.set('provider_admin_token', jsonData.access_token);",
                      "});",
                      "",
                      "pm.test(\"User is provider admin\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.user.role).to.eql('insurance_provider_admin');",
                      "});",
                      "",
                      "pm.test(\"Does NOT have system.admin permission\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.permissions).to.not.include('system.admin');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Junior Agent Login (Test User)",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\"phone_number\": \"+919876543204\", \"password\": \"testpassword\"}"
                },
                "url": {
                  "raw": "{{base_url}}/auth/login",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "auth",
                    "login"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has access_token\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property(\"access_token\");",
                      "    pm.environment.set(\"junior_agent_token\", jsonData.access_token);",
                      "});",
                      "",
                      "pm.test(\"Login successful\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property(\"access_token\");",
                      "    pm.expect(jsonData).to.have.property(\"user\");",
                      "    pm.expect(jsonData.user.status).to.eql(\"active\");",
                      "    pm.expect(jsonData.user.role).to.eql(\"junior_agent\");",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "\ud83d\udc65 User Management",
          "item": [
            {
              "name": "Get Current User Profile",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{super_admin_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/users/me",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "users",
                    "me"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has user data\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('user_id');",
                      "    pm.expect(jsonData).to.have.property('email');",
                      "    pm.expect(jsonData).to.have.property('role');",
                      "});",
                      "",
                      "pm.test(\"User is authenticated user\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.role).to.eql('super_admin');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Search & Filter Users (Admin Only)",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{super_admin_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/users/?role=policyholder&limit=5",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "users"
                  ],
                  "query": [
                    {
                      "key": "role",
                      "value": "policyholder"
                    },
                    {
                      "key": "limit",
                      "value": "5"
                    }
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is array of users\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "});",
                      "",
                      "pm.test(\"All returned users are policyholders\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    jsonData.forEach(function(user) {",
                      "        pm.expect(user.role).to.eql('policyholder');",
                      "    });",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Get User by ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{super_admin_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/users/{{test_user_id}}",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "users",
                    "{{test_user_id}}"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has correct user\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.user_id).to.eql('650742fb-5fa7-4913-8e4f-cdad3ccbe476');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Update User Profile",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{super_admin_token}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\"display_name\": \"Updated Test User\", \"language_preference\": \"hi\"}"
                },
                "url": {
                  "raw": "{{base_url}}/users/{{super_admin_user_id}}",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "users",
                    "{{super_admin_user_id}}"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"User profile updated\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.display_name).to.eql('Updated Test User');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Get User Preferences",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{super_admin_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/users/{{super_admin_user_id}}/preferences",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "users",
                    "{{super_admin_user_id}}",
                    "preferences"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has preferences\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('language_preference');",
                      "    pm.expect(jsonData).to.have.property('theme_preference');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Update User Preferences",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{super_admin_token}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\"language_preference\": \"en\", \"theme_preference\": \"dark\", \"notification_preferences\": {\"email\": true, \"sms\": false}}"
                },
                "url": {
                  "raw": "{{base_url}}/users/{{super_admin_user_id}}/preferences",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "users",
                    "{{super_admin_user_id}}",
                    "preferences"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Preferences updated\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.language_preference).to.eql('en');",
                      "    pm.expect(jsonData.theme_preference).to.eql('dark');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Deactivate User (Super Admin Only)",
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{super_admin_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/users/431432dc-823a-4a2e-8532-6c6b76c8c394",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "api",
                    "v1",
                    "users",
                    "431432dc-823a-4a2e-8532-6c6b76c8c394"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"User deactivated\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.message).to.include('deactivated');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "\ud83c\udfe5 Health Check",
          "item": [
            {
              "name": "System Health Check",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url}}/health",
                  "host": [
                    "{{api_host}}"
                  ],
                  "path": [
                    "health"
                  ]
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has proper headers\", function () {",
                      "    pm.response.to.have.header(\"Content-Type\", \"text/plain\");",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script",
          "pm.globals.set('timestamp', new Date().toISOString());"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script",
          "pm.test('Response time is less than 5000ms', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "pm.test('Response has proper headers', function () {",
          "    pm.response.to.have.header('Content-Type');",
          "});"
        ]
      }
    }
  ]
}